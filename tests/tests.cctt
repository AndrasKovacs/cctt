
isEquiv (A B : U)(f : A → B) : U :=
    (g    : B → A)
  × (linv : (x : A) → x = g (f x))
  × (rinv : (x : B) → f (g x) = x)
  × ((x : A) → refl ={i. f (linv x i) = f x} (rinv (f x)));

equiv (A B : U) : U :=
  (f : A → B) × isEquiv A B f;

idEquiv (A : U) : equiv A A :=
  (λ x. x, λ x. x, λ x _. x, λ x _. x, λ x _ _. x);

-- symufill (A B : U)(P : A = B)(i j : I) : U :=
--   -- hcom 0 j U [i=0. P; i=1 _. A] A;

symDep (A B : U) (P : A = B) (a : A) (b : B) (p : a ={P} b) : b ={P⁻¹} a :=
  -- λ i. com 0 1 (j. hcom 0 j U [i=0. P; i=1 _. A] A)
  --               [i=0 j. p j; i=1 j. a] a;
λ {b} {a} i. glue (hcom 0 1 A [i = 0 j. coe j 0 P (coe j 1 P (p {a}
{b} j)); i = 1 j. coe j 0 (_. A) (coe j 1 (j1. A) a); i = 0 i1. coe i1 0 P (coe
i1 1 P (p {a} {b} i1)); i = 1 i1. coe i1 0 (_. A) (coe i1 1 (j. A) a)] (hcom 1 0
A [i = 0 i1. coe 1 0 P (coe 0 1 P a); i = 1 i1. coe 1 0 (_. A) (coe 0 1 (j. A)
a)] (hcom 0 1 A [i = 0 j. coe j 1 (j1. A) (coe j 0 P (coe 0 j P a)); i = 1
j. coe j 1 (j1. A) (coe j 0 (_. A) (coe 0 j (j1. A) a))] (coe 0 1 (j. A) a))))
[i = 0. P {A} {B} @1, λ x. coe @1 0 P x, λ x. coe 0 @1 P x, λ x {x} {coe 0 @1 P
(coe @1 0 P x)} j. hcom j 0 (P {A} {B} j) [j = 0 k. x; j = 1 k. coe k 1 P (coe 1
k P x)] x, λ x {coe @1 0 P (coe 0 @1 P x)} {x} j. hcom 0 j A [j = 0 k. coe k 0 P
(coe 0 k P x); j = 1 k. x] x, λ x {λ {coe @1 0 P x} {coe @1 0 P x} _. coe @1 0 P
x} {λ {coe @1 0 P (coe 0 @1 P (coe @1 0 P x))} {coe @1 0 P x} k. hcom 0 k A [k =
0 k1. coe k1 0 P (coe 0 k1 P x); k = 1 k1. coe 1 0 P x] (coe k 0 P x)} l {coe l
0 P (hcom l 0 (P {A} {B} l) [l = 0 k. x; l = 1 k. coe k 1 P (coe 1 k P x)] x)}
{coe l 0 P x} k. hcom l 0 A [k = 0 i1. coe i1 0 P (coe l i1 P (hcom l i1 (P {A}
{B} l) [l = 0 k1. x; l = 1 k1. coe k1 1 P (coe 1 k1 P x)] x)); k = 1 i1. coe i1
0 P (coe l i1 P x); l = 0 i1. coe i1 0 P (coe 0 i1 P x); l = 1 i1. coe i1 0 P
(hcom i1 1 (P {A} {B} i1) [k = 0 k1. coe k1 i1 P (coe i1 k1 P (coe 1 i1 P x)); k
= 1 k1. coe 1 i1 P x] (coe 1 i1 P x))] (coe l 0 P x); i = 1. A, λ x. coe @1 0
(_. A) x, λ x. coe 0 @1 (_. A) x, λ x {x} {coe 0 @1 (_. A) (coe @1 0 (_. A) x)}
j. hcom j 0 A [j = 0 k. x; j = 1 k. coe k 1 (_. A) (coe 1 k (_. A) x)] x, λ x
{coe @1 0 (_. A) (coe 0 @1 (_. A) x)} {x} j. hcom 0 j A [j = 0 k. coe k 0 (_. A)
(coe 0 k (_. A) x); j = 1 k. x] x, λ x {λ {coe @1 0 (_. A) x} {coe @1 0 (_. A)
x} _. coe @1 0 (_. A) x} {λ {coe @1 0 (_. A) (coe 0 @1 (_. A) (coe @1 0 (_. A)
x))} {coe @1 0 (_. A) x} k. hcom 0 k A [k = 0 k1. coe k1 0 (_. A) (coe 0 k1
(_. A) x); k = 1 k1. coe 1 0 (_. A) x] (coe k 0 (_. A) x)} l {coe l 0 (_. A)
(hcom l 0 A [l = 0 k. x; l = 1 k. coe k 1 (_. A) (coe 1 k (_. A) x)] x)} {coe l
0 (_. A) x} k. hcom l 0 A [k = 0 i1. coe i1 0 (_. A) (coe l i1 (_. A) (hcom l i1
A [l = 0 k1. x; l = 1 k1. coe k1 1 (_. A) (coe 1 k1 (_. A) x)] x)); k = 1
i1. coe i1 0 (_. A) (coe l i1 (_. A) x); l = 0 i1. coe i1 0 (_. A) (coe 0 i1
(_. A) x); l = 1 i1. coe i1 0 (_. A) (hcom i1 1 A [k = 0 k1. coe k1 i1 (_. A)
(coe i1 k1 (_. A) (coe 1 i1 (_. A) x)); k = 1 k1. coe 1 i1 (_. A) x] (coe 1 i1
(_. A) x))] (coe l 0 (_. A) x)] [i = 0. b; i = 1. a];