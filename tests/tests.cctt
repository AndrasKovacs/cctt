
isEquiv (A B : U)(f : A → B) : U :=
    (g    : B → A)
  × (linv : (x : A) → x = g (f x))
  × (rinv : (x : B) → f (g x) = x)
  × ((x : A) → refl ={i. f (linv x i) = f x} (rinv (f x)));


equiv (A B : U) : U :=
  (f : A → B) × isEquiv A B f;

idEquiv (A : U) : equiv A A :=
  (λ x. x, λ x. x, λ x _. x, λ x _. x, λ x _ _. x);

symufill (A B : U)(P : A = B)(i j : I) : U :=
  hcom 0 j U [i=0. P; i=1 _. A] A;

  -- Glue (P j) [i=0. P j, coeIsEquiv (P j) A P j 0; i=1. A, coeIsEquiv A A (_.A) j 0]

symDep (A B : U) (P : A = B) (a : A) (b : B) (p : a ={P} b) : b ={P⁻¹} a :=
  λ i. com 0 1 (symufill A B P i)
               [i=0 j. p j; i=1 j. a] a;

  -- λ i. hcom 0 1 (symufill A B P i 1)
  --                 [ i=0 j. coe j 1 (symufill A B P i) (p j)
  -- 	             ; i=1 j. coe j 1 (symufill A B P i) a]
  -- 	           (coe 0 1 (symufill A B P i) a);

-- BAD with com
-- λ i. glue (hcom 0 1 [i = 0 j. coe j 0 P (coe j 1 P (p j)); i = 1
-- j. coe j 0 (_. A) (coe j 1 (j1. A) a); i = 0 i1. coe i1 0 P (coe i1 1 P (p i1));
-- i = 1 i1. coe i1 0 (_. A) (coe i1 1 (j. A) a)] (hcom 1 0 [i = 0 i1. coe 1 0 P
-- (coe 0 1 P a); i = 1 i1. coe 1 0 (_. A) (coe 0 1 (j. A) a)] (hcom 0 1 [i = 0
-- j. coe j 1 (j1. A) (coe j 0 P (coe 0 j P a)); i = 1 j. coe j 1 (j1. A) (coe j 0
-- (_. A) (coe 0 j (j1. A) a))] (coe 0 1 (j. A) a)))) [i = 0. b; i = 1. a];

-- GOOD without com
-- λ i. glue (hcom 0 1 [i = 0 j. coe 1 0 P (coe j 1 P (p j)); i = 1
-- j. coe 1 0 (_. A) (coe j 1 (k. A) a); i = 0 i1. coe 1 0 P (coe i1 1 P (p i1)); i
-- = 1 i1. coe 1 0 (_. A) (coe i1 1 (k. A) a)] (hcom 1 0 [i = 0 i1. coe 1 0 P (coe
-- 0 1 P a); i = 1 i1. coe 1 0 (_. A) (coe 0 1 (j. A) a)] (hcom 0 1 [i = 0 j. coe j
-- 1 (j1. A) (coe j 0 P (coe 0 j P a)); i = 1 j. coe j 1 (j1. A) (coe j 0 (_. A)
-- (coe 0 j (j1. A) a))] (coe 0 1 (j. A) a)))) [i = 0. b; i = 1. a];
