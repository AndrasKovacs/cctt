
-- Coercion is an equivalence.

isEquiv (A B : U)(f : A → B) : U :=
     (g    : B → A)
   × (linv : (a : A) → a = g (f a))
   × (rinv : (b : B) → f (g b) = b)
   × ((a : A) → refl ={i. f (linv a i) = f a} (rinv (f a)));

coeIsEquiv (A : I → U)(r r' : I) : isEquiv (A r) (A r') (λ x. coe r r' A x) :=
  let f'    (i : I)(x : A r)        : A i := coe r i A x;
  let g'    (i : I)(x : A i)        : A r := coe i r A x;
  let linv' (i : I)(x : A r)(j : I) : A r := hcom r i (A r) [j=0 k. x; j=1 k. coe k r A (coe r k A x)] x;
  let rinv' (i : I)(x : A i)(j : I) : A i := hcom i r (A i) [j=0 k. coe k i A (coe i k A x); j=1 k. x] x;

  ( λ x. g' r' x
  , λ x j. linv' r' x j
  , λ x j. rinv' r' x j
  , λ x l k. com r r' A [k=0 i. f' i (linv' i x l)
                        ;k=1 i. f' i x
		        ;l=0 i. f' i x
		        ;l=1 i. rinv' i (f' i x) k]
		        x
  );
